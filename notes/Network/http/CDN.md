# CDN

- [CDN](#cdn)
    - [CDN](#cdn-1)
    - [基本思路](#基本思路)
    - [目的](#目的)
    - [基础架构](#基础架构)
    - [服务模式](#服务模式)
    - [实例](#实例)
    - [CDN的一些名词](#cdn的一些名词)

----------

## CDN

CDN：Content Delivery Network，内容分发网络，一般也叫作缓存服务器

是在客户端和服务器之间增加了一个缓存区，导致每次客户端访问一个目标服务器的时候，不需要每次直接到源服务器获取内容

## 基本思路

尽可能避开互联网上有可能影响**数据传输速度和稳定性**的瓶颈和环节，是内容传输的更快、更稳定。

通过在**网络各处放置结点服务器**所构成的在现有的互联网基础上的一层**智能虚拟网络**。

CDN系统能够实时的根据**网络流量和各节点的连接、负载状况以及用户的距离和响应时间**等综合信息将用户的**请求重新定向到距离用户最近的服务节点上**

## 目的 

**使用户可就近取得所需内容，解决Internet网络拥挤的状况，提高用户访问网站的响应速度和成功率**

- 加速网站的访问
- 实现跨运营商，跨地域的全网覆盖
- 保障网站安全
  - CDN的负载均衡和分布式存储技术，可以加强网站的可靠性，相当无无形中给你的网站添加了一把保护伞，应对绝大部分的互联网攻击事件。防攻击系统也能避免网站遭到恶意攻击。 
- 异地备援
  - 当某个服务器发生意外故障时，系统将会调用其他临近的健康服务器节点进行服务，进而提供接近100%的可靠性，这就让你的网站可以做到永不宕机。 

## 基础架构

**CDN网络是由一个DNS服务器和几台缓存服务器组成**

1. 当用户点击网站页面上的内容URL，经过本地DNS解析只获得**CNAME**，DNS系统会将**最终域名解析全交给CNAME指向的CDN专用DNS服务器**

2. CDN的DNS服务器将CDN的**全局负载均衡设备**的IP地址返回给用户（这个全局负载均衡设备可以管理到多个区域负载均衡设备）

3. 用户向**CDN的全局负载均衡设备**发起内容请求的URL访问请求

4. CDN全局负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的**区域负载均衡设备**，告诉用户向这台设备发起请求

5. 区域负载均衡服务器会为用户选择一台**合适的缓存服务器**提供服务。

   - 选择的依据包括：
   - 根据用户ip地址，判断那一台缓存服务器**距离用户最近**；
   - 根据用户所请求的URl中携带的内容名称，判断那一台服务器上有**用户所需内容**；
   - 查询各个服务器的当前负载情况，判断那一台服务器尚有**服务能力**。

   根据以上的综合分析，**区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的IP地址**

6. 全局负载均衡设备把**缓存服务器的IP地址返回给用户**

7. 用户向这台缓存服务器发起请求，**缓存服务器响应用户请求，将用户所需内容传送到用户终端。**

   - 如果这台缓存服务器上并**没有用户想要的内容**，而区域均衡设备依然将它分配给了用户，那么这台缓存服务器就要向他的**上一级缓存服务器**请求内容，直到追溯到网站的**源服务器**将内容拉到本地

## 服务模式

CDN就是一个策略性部署的整体系统，包括**分布式存储、负载均衡、网络请求重定向和内容管理**四个方面，而内容管理和全局的网络流量管理是CDN的核心所在。

## 实例

通过在现有的Internet中增加一层新的网络架构，将网站的内容发布到最接近用户的cache服务器内，通过DNS负载均衡的技术，判断用户来源就近访问cache服务器取得所需的内容，解决Internet网络拥塞状况，提高用户访问网站的响应速度，如同提供了多个分布在各地的加速器，以达到快速、可冗余的为多个网站加速的目的。

## CDN的一些名词

**1、Origin Server源站**

做 CDN 之前的客户真正的服务器。

**2、User**

访问者，也就是要访问网站的网民。

**3、Last Mile**
最后一公里，也就是网民到他所访问到的 CDN 服务器之间的路径。

**4、域名**
域名是Internet网络上的一个服务器或一个网络系统的名字，全世界，没有重复的域名。

**5、CNAME记录**

它是一个别名记录( Canonical Name )；当 DNS 系统在查询 CNAME 左面的名称的时候，都会转向 CNAME 右面的名称再进行查询，一直追踪到最后的 PTR 或 A 名称，成功查询后才会做出回应，否则失败。

**6、CNAME域名**

CDN的域名加速需要用到CNAME记录，在阿里云控制台配置完成CDN加速后，您会得到一个加速后的域名，称之为CNAME域名（该域名一定是* . * [kunlun.com](https://link.zhihu.com/?target=http%3A//kunlun.com)）， 用户需要将自己的域名作CNAME指向这个* . * [kunlun.com](https://link.zhihu.com/?target=http%3A//kunlun.com)的域名后，域名解析的工作就正式转向阿里云，该域名所有的请求都将转向阿里云CDN的节点。

CNAME域名就是一个加速域名，也就是在原先域名之后再次添加一些域名，对于原先域名进行了补充

**7、DNS**

DNS即Domain Name System，是域名解析服务的意思。它在互联网的作用是：把域名转换成为网络可以识别的ip地址。人们习惯记忆域名，但机器间互相只认IP地址，域名与IP地址之间是一一对应的，它们之间的转换工作称为域名解析，域名解析需要由专门的域名解析服务器来完成，整个过程是自动进行的。

比如：上网时输入的[百度一下，你就知道](https://link.zhihu.com/?target=http%3A//www.baidu.com)会自动转换成为220.181.112.143

**8、边缘节点**

也称CDN节点、Cache节点等；是相对于网络的复杂结构而提出的一个概念，指距离最终用户接入具有较少的中间环节的网络节点，对最终接入用户有较好的响应能力和连接速度。其作用是将访问量较大的网页内容和对象保存在服务器前端的专用cache设备上，以此来提高网站访问的速度和质量。

**9、cache**

cache高速缓冲存储器一种特殊的存储器子系统，其中复制了频繁使用的数据以利于快速访问。存储器的高速缓冲存储器存储了频繁访问的RAM位置的内容及这些数据项的存储地址。当处理器引用存储器中的某地址时，高速缓冲存储器便检查是否存有该地址。如果存有该地址，则将数据返回处理器;如果没有保存该地址，则进行常规的存储器访问。因为高速缓冲存储器总是比主RAM存储器速度快，所以当RAM的访问速度低于微处理器的速度时，常使用高速缓冲存储器。

 ##  CDN与传统网站访问的区别： 

传统访问访问：

<img src="https://pic4.zhimg.com/50/f9708de32d641358e47edc96307775d5_hd.jpg" data-rawwidth="433" data-rawheight="444" class="origin_image zh-lightbox-thumb" width="433" data-original="https://pic4.zhimg.com/f9708de32d641358e47edc96307775d5_r.jpg"/>![img](https://pic4.zhimg.com/80/f9708de32d641358e47edc96307775d5_hd.jpg)

 

 

使用了CDN的网站访问：

 

<img src="https://pic1.zhimg.com/50/79c1abc468349073fb433d0949423717_hd.jpg" data-rawwidth="824" data-rawheight="567" class="origin_image zh-lightbox-thumb" width="824" data-original="https://pic1.zhimg.com/79c1abc468349073fb433d0949423717_r.jpg"/>![img](https://pic1.zhimg.com/80/79c1abc468349073fb433d0949423717_hd.jpg)

 

与传统访问方式不同，CDN网络则是在用户和服务器之间增加缓存层，将用户的访问请求引导到最优的缓存节点而不是服务器源站点，从而加速访问速度。

 

**完整的CDN工作流程：**

<img src="https://pic2.zhimg.com/50/049b124feb55100ff2f147b768ad4c8b_hd.jpg" data-rawwidth="400" data-rawheight="423" class="content_image" width="400"/>![img](https://pic2.zhimg.com/80/049b124feb55100ff2f147b768ad4c8b_hd.jpg)

总结一下CDN的工作原理：通过权威DNS服务器来实现最优节点的选择，通过缓存来减少源站的压力。

参考文献：

1. 知乎：视界云
2. 知乎：阿里云云栖社区